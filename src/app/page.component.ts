import { Component, OnInit, HostBinding } from '@angular/core';
import { Location } from '@angular/common';
import { ActivatedRoute, Params } from '@angular/router';
import { FormsModule } from '@angular/forms';

import { Comment } from './comment';
import { Page } from './page';
import { ContentService } from './content.service';
import { slideAnimation, pageTurn } from './animations';

@Component({
	animations: [ pageTurn ],
	template: `
	<div class="page">
		<a class="go-back" (click)="goBack()">&larr; back</a>
		<h3 [innerHtml]="page?.title.rendered"></h3>
		<div class="page-content" [innerHtml]="page?.content.rendered"></div>
		<!--img src="/images/flourish.svg" width="100%" /-->
<svg version="1.1" id="end-ornament" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="100%" height="100%" viewBox="0 0 424 67" enable-background="new 0 0 424 67" xml:space="preserve">
<g>
	<path fill="#b4b5ba" d="M230.749,32.885c0,0-0.152-0.137-0.448-0.402c-0.3-0.257-0.72-0.687-1.292-1.152
		c-1.134-0.945-2.81-2.364-5.125-3.786c-2.281-1.462-5.182-2.988-8.688-4.161c-3.502-1.209-7.614-1.865-12.071-2.442
		c-4.462-0.561-9.402-0.916-14.648-0.499c-0.637,0.056-1.277,0.113-1.922,0.169c-0.699,0.083-1.402,0.165-2.109,0.249
		c-1.298,0.191-2.598,0.39-3.972,0.664c-2.713,0.533-5.465,1.241-8.237,2.109c-5.538,1.754-11.181,4.065-16.866,6.724
		c-5.692,2.643-11.436,5.608-17.358,8.369c-5.921,2.752-12.021,5.331-18.283,7.234c-6.238,1.839-12.47,3.27-18.666,3.983
		c-6.173,0.702-12.349,0.701-18.046-0.736c-5.689-1.359-10.758-4.551-13.827-8.705c-0.774-1.029-1.444-2.09-2.028-3.16
		c-0.279-0.564-0.529-1.038-0.819-1.658l-0.316-0.783c-0.104-0.262-0.197-0.598-0.292-0.891c-0.701-2.355-0.584-4.829,0.327-6.851
		c0.895-2.024,2.51-3.514,4.254-4.232c1.748-0.756,3.587-0.691,5.032-0.211c1.457,0.488,2.542,1.33,3.346,2.132
		c0.818,0.804,1.341,1.618,1.752,2.271c0.381,0.674,0.65,1.197,0.8,1.565c0.163,0.361,0.248,0.547,0.248,0.547l-0.32,0.149
		c0,0-0.1-0.173-0.293-0.509c-0.18-0.343-0.491-0.825-0.917-1.434c-0.454-0.584-1.009-1.317-1.825-1.99
		c-0.8-0.676-1.836-1.335-3.104-1.643c-1.259-0.291-2.746-0.229-4.106,0.472c-1.358,0.674-2.553,1.95-3.145,3.587
		c-0.615,1.629-0.539,3.594,0.107,5.436c0.09,0.227,0.144,0.429,0.26,0.681l0.357,0.765c0.258,0.456,0.52,0.917,0.784,1.383
		c0.578,0.936,1.227,1.85,1.958,2.723c2.916,3.511,7.38,6.003,12.536,7c5.158,1.043,10.891,0.794,16.689-0.155
		c5.81-0.952,11.758-2.622,17.626-4.665c5.827-2.082,11.542-4.823,17.202-7.792c5.666-2.961,11.313-6.107,17.049-9.051
		c5.735-2.934,11.583-5.672,17.576-7.654c2.989-1.004,5.997-1.845,8.993-2.498c1.479-0.327,3.024-0.601,4.541-0.848
		c0.706-0.098,1.407-0.195,2.104-0.292c0.845-0.105,1.497-0.174,2.25-0.247c5.819-0.52,11.448-0.481,16.556,0.489
		c5.116,0.956,9.562,2.969,13.207,5.062c3.644,2.134,6.511,4.44,8.567,6.599c2.049,2.177,3.395,4.044,4.216,5.407
		c0.432,0.67,0.7,1.177,0.889,1.53c0.188,0.35,0.285,0.531,0.285,0.531L230.749,32.885z"/>

	<path fill="#b4b5ba" d="M68.253,42.905c0,0-0.984-0.741-2.733-1.986c-0.868-0.629-1.946-1.358-3.176-2.202
		c-1.237-0.832-2.639-1.759-4.205-2.705c-1.562-0.951-3.27-1.946-5.115-2.915c-0.921-0.486-1.89-0.938-2.868-1.418
		c-1.005-0.419-2.003-0.913-3.063-1.294c-2.093-0.835-4.313-1.503-6.581-2.028c-0.567-0.131-1.145-0.208-1.718-0.316
		c-0.574-0.106-1.148-0.208-1.73-0.246l-1.736-0.186l-1.738-0.05c-0.579-0.044-1.154-0.014-1.729,0.022
		c-0.558,0.042-1.184,0.025-1.685,0.084l-0.9,0.105l-0.782,0.136c-0.527,0.104-1.09,0.206-1.616,0.36
		c-2.133,0.57-4.154,1.457-5.693,2.712c-0.762,0.633-1.371,1.349-1.861,2.11c-0.417,0.789-0.733,1.618-0.804,2.493
		c-0.075,0.431-0.005,0.878-0.034,1.314c0.043,0.313,0.107,1.032,0.212,1.35c0.145,0.756,0.527,1.555,0.923,2.225
		c0.87,1.333,2.133,2.268,3.4,2.814c1.273,0.548,2.521,0.766,3.552,0.826c1.035,0.054,1.865-0.012,2.428-0.081
		c0.563-0.088,0.864-0.135,0.864-0.135l0.081,0.261c0,0-0.293,0.109-0.843,0.313c-0.556,0.191-1.395,0.427-2.508,0.553
		c-1.111,0.138-2.505,0.099-4.071-0.307c-1.551-0.422-3.272-1.355-4.637-2.968c-0.629-0.853-1.199-1.748-1.561-2.921
		c-0.218-0.621-0.256-0.918-0.415-1.606c-0.045-0.586-0.164-1.181-0.116-1.799c0.01-1.242,0.354-2.517,0.897-3.719
		c0.604-1.166,1.411-2.245,2.389-3.126c1.962-1.746,4.333-2.96,6.846-3.687c0.629-0.198,1.261-0.332,1.923-0.476l1.021-0.169
		l0.92-0.103c0.715-0.071,1.318-0.061,1.984-0.079c0.652-0.017,1.303-0.025,1.949,0.043c2.606,0.096,5.122,0.729,7.533,1.402
		c2.39,0.76,4.678,1.646,6.791,2.687c1.073,0.487,2.071,1.068,3.076,1.581c0.972,0.569,1.934,1.107,2.839,1.675
		c1.811,1.139,3.489,2.256,4.977,3.369c2.987,2.209,5.354,4.183,6.96,5.626c1.615,1.426,2.514,2.263,2.513,2.263L68.253,42.905z"/>
</g>
<g>
	<path fill="#b4b5ba" d="M197.926,25.794c0,0,0.152,0.137,0.448,0.402c0.3,0.257,0.72,0.687,1.292,1.152
		c1.134,0.945,2.81,2.364,5.125,3.786c2.28,1.462,5.182,2.988,8.688,4.161c3.502,1.208,7.614,1.864,12.071,2.441
		c4.462,0.561,9.401,0.916,14.648,0.499c0.636-0.056,1.277-0.113,1.922-0.169c0.699-0.083,1.402-0.165,2.109-0.249
		c1.298-0.191,2.598-0.39,3.972-0.664c2.713-0.533,5.465-1.241,8.237-2.109c5.538-1.753,11.181-4.064,16.866-6.723
		c5.692-2.643,11.436-5.607,17.358-8.368c5.921-2.752,12.02-5.331,18.282-7.234c6.238-1.839,12.47-3.27,18.665-3.983
		c6.174-0.702,12.35-0.701,18.047,0.736c5.689,1.359,10.757,4.551,13.827,8.705c0.774,1.029,1.444,2.09,2.028,3.161
		c0.279,0.564,0.529,1.038,0.82,1.657l0.316,0.783c0.104,0.262,0.198,0.598,0.292,0.891c0.701,2.355,0.585,4.829-0.326,6.85
		c-0.895,2.024-2.51,3.514-4.253,4.233c-1.748,0.756-3.587,0.691-5.031,0.212c-1.458-0.488-2.542-1.33-3.347-2.132
		c-0.818-0.804-1.341-1.618-1.753-2.271c-0.381-0.674-0.649-1.197-0.8-1.565c-0.163-0.361-0.248-0.547-0.248-0.547l0.32-0.149
		c0,0,0.1,0.173,0.293,0.509c0.18,0.343,0.491,0.825,0.917,1.434c0.454,0.584,1.009,1.317,1.825,1.99
		c0.8,0.676,1.836,1.335,3.104,1.643c1.259,0.291,2.746,0.229,4.106-0.473c1.357-0.674,2.553-1.95,3.145-3.587
		c0.614-1.629,0.538-3.594-0.107-5.436c-0.091-0.227-0.144-0.429-0.26-0.681l-0.357-0.765c-0.258-0.456-0.52-0.917-0.784-1.383
		c-0.579-0.936-1.228-1.85-1.958-2.723c-2.916-3.511-7.38-6.003-12.536-7c-5.159-1.043-10.891-0.794-16.689,0.155
		c-5.81,0.952-11.758,2.622-17.626,4.665c-5.827,2.083-11.542,4.823-17.201,7.792c-5.666,2.961-11.313,6.107-17.049,9.051
		c-5.735,2.934-11.583,5.672-17.576,7.654c-2.988,1.004-5.997,1.845-8.993,2.498c-1.479,0.327-3.024,0.6-4.541,0.848
		c-0.706,0.098-1.407,0.194-2.104,0.291c-0.844,0.105-1.497,0.174-2.25,0.247c-5.819,0.52-11.448,0.481-16.556-0.489
		c-5.115-0.956-9.562-2.968-13.207-5.062c-3.644-2.134-6.511-4.441-8.567-6.599c-2.049-2.177-3.395-4.044-4.216-5.407
		c-0.432-0.67-0.7-1.177-0.889-1.53c-0.188-0.35-0.285-0.531-0.285-0.531L197.926,25.794z"/>

	<path fill="#b4b5ba" d="M360.423,15.774c0,0,0.984,0.741,2.733,1.986c0.868,0.629,1.946,1.359,3.176,2.202
		c1.237,0.832,2.639,1.758,4.205,2.705c1.562,0.952,3.27,1.946,5.115,2.915c0.921,0.486,1.89,0.938,2.868,1.418
		c1.005,0.419,2.003,0.913,3.063,1.294c2.093,0.835,4.313,1.503,6.581,2.029c0.567,0.131,1.146,0.208,1.718,0.315
		c0.574,0.106,1.148,0.208,1.73,0.246l1.736,0.186l1.738,0.05c0.579,0.045,1.155,0.014,1.729-0.022
		c0.558-0.042,1.184-0.025,1.685-0.084l0.899-0.105l0.782-0.136c0.527-0.104,1.09-0.206,1.615-0.361
		c2.133-0.57,4.154-1.457,5.693-2.712c0.762-0.633,1.371-1.349,1.861-2.11c0.417-0.789,0.732-1.618,0.804-2.494
		c0.075-0.431,0.005-0.878,0.034-1.314c-0.044-0.313-0.107-1.032-0.213-1.35c-0.144-0.756-0.527-1.555-0.923-2.225
		c-0.87-1.333-2.133-2.268-3.4-2.813c-1.273-0.548-2.521-0.766-3.553-0.826c-1.034-0.054-1.865,0.012-2.428,0.081
		c-0.563,0.088-0.864,0.135-0.864,0.135l-0.08-0.261c0,0,0.293-0.109,0.843-0.313c0.556-0.191,1.395-0.427,2.508-0.553
		c1.11-0.138,2.505-0.1,4.071,0.307c1.551,0.421,3.272,1.354,4.637,2.968c0.629,0.853,1.198,1.748,1.561,2.921
		c0.219,0.621,0.257,0.918,0.415,1.606c0.045,0.586,0.164,1.181,0.116,1.799c-0.011,1.242-0.354,2.517-0.897,3.719
		c-0.604,1.166-1.41,2.245-2.389,3.126c-1.962,1.746-4.332,2.961-6.846,3.688c-0.629,0.198-1.261,0.332-1.923,0.477l-1.021,0.168
		l-0.92,0.103c-0.715,0.071-1.318,0.061-1.984,0.079c-0.652,0.017-1.303,0.025-1.949-0.043c-2.606-0.096-5.122-0.729-7.533-1.402
		c-2.39-0.76-4.678-1.646-6.791-2.687c-1.073-0.487-2.071-1.068-3.076-1.581c-0.972-0.569-1.934-1.107-2.84-1.675
		c-1.81-1.139-3.489-2.256-4.977-3.369c-2.987-2.209-5.354-4.183-6.96-5.626c-1.615-1.427-2.514-2.263-2.513-2.263L360.423,15.774z"
		/>
</g>
</svg>
	</div>
	<div class="comments">
		<div [hidden]="displayForm">
			<button (click)="showForm()">add comment</button>
		</div>
		<div [hidden]="!displayForm">
			<h6>Leave a comment</h6>
			<form (ngSubmit)="submitComment()">
				<label for="name">Name</label>
				<input [(ngModel)]="comment.author_name" name="name" id="name" type="text">
				<br/>
				<label for="email">Email address</label>
				<input [(ngModel)]="comment.author_email" name="email" id="email" type="email">
				<br/>
				<label for="content">Your comment</label>
				<textarea [(ngModel)]="comment.content" name="content" id="content" placeholder="your comment"></textarea>
				<button>post</button>
			</form>
		</div>
		<ul *ngFor="let comment of comments">
			<li class="comment">
				<h6>comment by {{comment.author_name}}</h6>
				<div [innerHTML]="comment.content.rendered"></div>
			</li>
		</ul>
	</div>
	<footer>
	<div class="footer-links">
		<a href="https://www.facebook.com/wellingupbook/">Facebook</a>
		<a>Contact</a>
	</div>
	</footer>
	`,
	styles: [`
		.comments {
			display: flex;
			flex-direction: row-reverse;
			justify-content: space-between;
			flex-wrap: wrap;
			margin: 0 auto;
			width: 66%;
		}
		.comments ul {
			flex: 0 1 16em;
			padding: 0;
		}
		.comments h6 {
			margin: 0;
		}
		.comment {
			background: #cea5de linear-gradient(170deg, #cea5de, #e0b9f3);
			box-shadow: 0 8px 8px #42395666;
			font-size: 0.8em;
			list-style: none;
			padding: 1em 2em;
		}
		.comments form {
			background: #f6f18a;
			padding: 2rem;
			display: flex;
			flex-direction: column;
		}
		.comments label {
			color: #817328;
			font-size: .9rem;
		}
		input, textarea {
			margin-bottom: 1rem;
			background: #fffba7;
			box-shadow: none;
		}
	`],
	providers: [ ContentService ]
})


export class PageComponent implements OnInit {

	id: number;
	page: Page;
	comments: Array<Comment>;
	comment: Comment;

	displayForm: boolean;

	constructor(
		private contentService:ContentService,
		private route:ActivatedRoute,
		private location:Location
	) {}

	ngOnInit(): void {
		this.id = +this.route.snapshot.params['id'];
		this.comment = new Comment(
			'',
			'',
			'',
			this.id
		);
		this.contentService.getPage(this.id).then(resolvedPage => this.page = resolvedPage)
		this.contentService.getCommentsForPage(this.id).subscribe( comments => { this.comments = comments })
	}

	goBack(): void {
		this.location.back();
	}
	showForm(): void {
		this.displayForm = true;
	}

	submitComment(): void {
		// send POST request to API
		this.contentService.postComment(this.comment)
		this.displayForm = false;
	}

}
